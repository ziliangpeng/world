# Go 1.10 Release Notes

**Released:** February 16, 2018
**EOL:** August 2019 (expected)

## Major Highlights

Go 1.10 focuses on tooling improvements and quality of life enhancements for developers:

1. **Build caching** - The go command now caches built packages, dramatically speeding up builds without requiring manual `-i` flags
2. **Test result caching** - Test results are now cached when inputs haven't changed, making iterative testing much faster
3. **Automatic `go vet` in tests** - Tests now run a subset of `go vet` checks automatically before execution
4. **Cgo string passing** - Direct passing of Go strings to C code is now supported via `_GoString_` type
5. **Better GOROOT detection** - The go tool can now deduce GOROOT from its executable path, allowing binary distributions to work anywhere
6. **Test streaming** - `go test -v` now streams `t.Log` output as it happens rather than buffering

## Breaking Changes

- 游댮 **cgo** Cgo options are now restricted to a safe list for security - may cause `invalid flag in #cgo CFLAGS` errors
- 游댮 **cgo** C types `CFTypeRef` and `jobject` hierarchies now map to `uintptr` instead of pointer types - requires `gofix` rewrite
- 游리 **net/url** `ResolveReference` now preserves multiple leading slashes in paths per RFC 3986 - may break code expecting single slash normalization

## New Features

- 游릭 **go command** Build cache introduced - speeds up builds without manual `-i` flags
- 游릭 **go command** Test result caching - cached results shown with "(cached)" marker
- 游릭 **go command** Automatic `go vet` execution during `go test` - catches problems before running tests
- 游리 **go command** `GOTMPDIR` environment variable to control temporary file location
- 游리 **go command** Automatic GOROOT deduction from executable path when `$GOROOT` unset
- 游리 **go command** Build flags `-asmflags`, `-gcflags`, `-gccgoflags`, `-ldflags` now support pattern-based targeting
- 游릭 **go test** New `-failfast` flag to stop after first test failure
- 游릭 **go test** New `-json` flag for machine-readable JSON output via `test2json`
- 游릭 **go test** Improved `-coverpkg` flag now accepts patterns like `all` for comprehensive coverage
- 游릭 **go test** Tests now more likely to write profiles before timing out
- 游리 **cgo** Direct string passing between Go and C via `_GoString_` type in C preamble
- 游리 **cgo** Go type aliases now used for C typedefs (e.g., `C.X` and `C.Y` interchangeable for `typedef X Y`)
- 游리 **cgo** Support for niladic function-like macros
- 游리 **cgo** Per-target C compiler configuration via `CC_FOR_goos_goarch` environment variables

## Improvements

- 游릭 **Compiler** Many performance improvements to generated code across all architectures
- 游릭 **Compiler** Better DWARF debug info with constant values, more accurate line numbers, package-level compilation units
- 游릭 **Compiler** Source-level stepping through programs now works better
- 游릭 **Runtime** `LockOSThread`/`UnlockOSThread` now properly nest - multiple locks require matching unlocks
- 游릭 **Runtime** Stack traces no longer include implicit wrapper functions (marked `<autogenerated>`) unless fault occurs in wrapper
- 游릭 **Runtime** Garbage collector modified to reduce impact on allocation latency
- 游릭 **Runtime** No longer any limit on `GOMAXPROCS` setting (was 1024 in Go 1.9)
- 游릭 **Runtime** `GOROOT()` function now defaults to GOROOT at compile time of calling program, not toolchain
- 游리 **go doc** Functions returning slices of `T` or `*T` now shown with type `T` display

## Tooling & Developer Experience

- 游리 **go command** Binary-only packages now require accurate import blocks in stub source
- 游리 **go command** `go install` now only installs packages named on command line (use `-i` to install dependencies)
- 游리 **go command** Build decisions now based purely on content, not modification times
- 游릭 **go test** `-v` output includes `PAUSE` and `CONT` markers for parallel tests
- 游릭 **go test** stdout and stderr from test binaries now always merged
- 游리 **go get** Now supports Fossil source code repositories
- 游리 **go fix** Replaces imports of `"golang.org/x/net/context"` with `"context"`
- 游리 **gofmt** Complex three-index slice expressions now formatted with consistent spacing: `x[i+1 : j : k]`
- 游리 **gofmt** Single-method interface literals on one line no longer split onto multiple lines
- 游리 **vet** Always has access to complete, up-to-date type information including cgo and vendored imports

## Implementation Details

- 游릭 **Compiler** Build modes ported to more systems: `c-shared` on linux/ppc64le, windows/386, windows/amd64; `pie` on darwin/amd64; `plugin` on linux/ppc64le, darwin/amd64
- 游릭 **Assembler** ARM 32-bit: 24 new floating-point and bit manipulation instructions
- 游릭 **Assembler** ARM 64-bit: 15 new SIMD and vector instructions
- 游릭 **Assembler** PowerPC 64-bit: 14 new POWER9 instructions
- 游릭 **Assembler** S390X: 4 new test mask instructions
- 游릭 **Assembler** X86 64-bit: 359 new instructions including full AVX, AVX2, BMI, BMI2, F16C, FMA3, SSE2-4.2 sets

## Platform & Environment

- 游리 **Platform** FreeBSD now requires 10.3 or later (was 9.3)
- 游리 **Platform** NetBSD now supported on amd64 and 386 (requires unreleased NetBSD 8)
- 游리 **Platform** 32-bit MIPS: `GOMIPS=hardfloat` (default) vs `GOMIPS=softfloat` for floating-point handling
- 游리 **Platform** linux/ppc64le now requires external linking with any cgo usage
- 游릭 **Platform** OpenBSD 6.2 will be required in Go 1.11 (currently 6.0+)
- 游릭 **Platform** OS X 10.10 Yosemite will be required in Go 1.11 (currently 10.8+)
- 游릭 **Platform** Windows 7 will be required in Go 1.11 (currently XP+)

## Standard Library Changes

### Major Changes

- 游리 **bytes** `Fields`, `FieldsFunc`, `Split`, `SplitAfter` now return subslices with capacity equal to length - prevents overwriting adjacent data
- 游리 **net/url** `UserInfo` methods now handle nil receiver gracefully (equivalent to zero value)
- 游리 **os** `File` adds `SetDeadline`, `SetReadDeadline`, `SetWriteDeadline` methods for non-blocking I/O
- 游리 **os** New `IsTimeout` function reports whether error represents a timeout
- 游릭 **strings** New `Builder` type for efficient string accumulation without duplicate copies

### archive/tar

- 游릭 **archive/tar** `FileInfoHeader` now records user/group names and device numbers
- 游릭 **archive/tar** New `Header.Format` field controls tar header format selection
- 游릭 **archive/tar** Support for arbitrary PAX records via `Header.PAXRecords`
- 游릭 **archive/tar** Sub-second precision in PAX-format headers

### archive/zip

- 游리 **archive/zip** Support for Info-Zip time extension (Unix epoch timestamps)
- 游리 **archive/zip** New `FileHeader.Modified` field of type `time.Time` replaces `ModifiedTime`/`ModifiedDate`
- 游리 **archive/zip** UTF-8 bit now set only when both name and comment are valid UTF-8
- 游리 **archive/zip** New `FileHeader.NonUTF8` field to disable UTF-8 heuristic
- 游리 **archive/zip** `Writer.SetComment` method to set archive comment

### crypto

- 游리 **crypto/cipher** `NewOFB` now panics on incorrect IV length (was returning nil)
- 游리 **crypto/tls** TLS server now advertises SHA-512 signatures in TLS 1.2
- 游리 **crypto/x509** `Certificate.Verify` now enforces all name constraints and extended key usage at once
- 游리 **crypto/x509** New `MarshalPKCS1PublicKey`/`ParsePKCS1PublicKey` for RSA public keys
- 游리 **crypto/x509** New `MarshalPKCS8PrivateKey` for PKCS#8 private key encoding
- 游리 **crypto/x509** Certificates now report URI names and IP/email/URI constraints
- 游리 **crypto/x509/pkix** `Name.String` now formats distinguished names in RFC 2253 format

### database/sql

- 游리 **database/sql/driver** Drivers can now construct `sql.DB` via `Connector` interface and `sql.OpenDB`
- 游리 **database/sql/driver** `DriverContext.OpenConnector` allows parsing config once per DB instead of per connection
- 游리 **database/sql/driver** Context-based interfaces now work without implementing non-context versions
- 游리 **database/sql/driver** `SessionResetter` interface allows drivers to reset connection state when returning to pool

### debug

- 游릭 **debug/elf** 348 new relocation constants for various architectures
- 游릭 **debug/macho** Support for reading relocations from Mach-O sections
- 游릭 **debug/macho** Support for `LC_RPATH` load command
- 游릭 **debug/macho** New named constants for header flag bits

### encoding

- 游리 **encoding/asn1** `Marshal` now encodes asterisks as UTF8String, respects `application` directive
- 游리 **encoding/asn1** New `MarshalWithParams` function for parameterized marshaling
- 游리 **encoding/asn1** `Unmarshal` respects `explicit` and `tag` directives
- 游리 **encoding/asn1** New `numeric` struct field tag for NumericString
- 游리 **encoding/csv** `Reader` disallows nonsensical `Comma`/`Comment` settings
- 游리 **encoding/csv** `ParseError` now has `StartLine` field for multi-line record errors
- 游릭 **encoding/hex** New `NewEncoder`/`NewDecoder` for streaming conversions
- 游리 **encoding/hex** `Decode`/`DecodeString` return partial results on malformed input
- 游리 **encoding/json** `Decoder.DisallowUnknownFields` method causes unknown JSON fields to error
- 游리 **encoding/json** `Unmarshal` now errors when decoding into unexported embedded pointer fields
- 游릭 **encoding/pem** `Encode`/`EncodeToMemory` no longer generate partial output on impossible blocks
- 游릭 **encoding/xml** New `NewTokenDecoder` for creating decoder from `TokenReader`

### go tools

- 游릭 **go/doc** Functions returning slices now in Type's Funcs list
- 游릭 **go/importer** `For` now accepts non-nil lookup argument
- 游릭 **go/printer** Implements gofmt formatting changes

### hash

- 游리 **hash** All standard library hash implementations now support `encoding.BinaryMarshaler`/`BinaryUnmarshaler`

### html/template

- 游릭 **html/template** New `Srcset` content type for img srcset attributes

### math

- 游리 **math/big** `Int.SetString`/`Text` now support bases 2-62 (was 2-36)
- 游리 **math/big** `Int.CmpAbs` compares absolute values
- 游릭 **math/big** `Float.Sqrt` for square roots
- 游리 **math/cmplx** Branch cuts corrected to match C99 standard
- 游릭 **math/rand** New `Shuffle` function and `Rand.Shuffle` method
- 游릭 **math** New `Round` and `RoundToEven` functions
- 游릭 **math** New `Erfinv` and `Erfcinv` inverse error functions

### net

- 游리 **net** `Conn` and `Listener` `Close` now guarantees file descriptor closed before returning
- 游리 **net** `TCPListener` and `UnixListener` implement `syscall.Conn`
- 游리 **net** `Pipe` connections now support setting read/write deadlines
- 游리 **net** `IPConn` and `UDPConn` message methods now implemented on Windows

### net/http

- 游리 **net/http** HTTPS proxy support via `https://` proxy URLs
- 游리 **net/http** `FileServer` applies `If-Range` checks to HEAD requests
- 游리 **net/http** `FileServer` reports directory read failures to ErrorLog
- 游리 **net/http** `ResponseWriter.WriteHeader` panics on invalid status codes
- 游리 **net/http** `Redirect` sets Content-Type before writing response

### Other packages

- 游리 **net/mail** `ParseAddress`/`ParseAddressList` support obsolete address formats
- 游리 **net/smtp** `Client.Noop` method tests server responsiveness
- 游리 **net/textproto** `ReadMIMEHeader` rejects headers starting with continuation lines
- 游릭 **os** `Chtimes` supports nanosecond precision on BSD, macOS, Solaris
- 游리 **reflect** `Copy` allows copying from string to byte array/slice
- 游릭 **runtime/pprof** Blocking and mutex profiles include symbol information
- 游리 **strconv** `ParseUint` returns maximum magnitude integer on `ErrRange` (was 0)
- 游리 **syscall** Windows: `SysProcAttr.Token` allows running process as another user
- 游리 **syscall** BSD/macOS/Solaris: `UtimesNano` now implemented
- 游리 **time** `LoadLocation` uses `$ZONEINFO` directory/zip before system locations
- 游릭 **time** New `LoadLocationFromTZData` for converting IANA timezone data
- 游릭 **unicode** Upgraded from Unicode 9.0 to Unicode 10.0 (8,518 new characters, 4 new scripts)
